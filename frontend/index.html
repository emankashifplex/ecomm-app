<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Registration and Login</title>
</head>
<body>
    <h1>User Registration and Login</h1>

    <!-- Registration Form -->
    <h2>Registration</h2>
    <form id="registrationForm">
        <label for="regUsername">Username:</label>
        <input type="text" id="regUsername" required><br>
        <label for="regPassword">Password:</label>
        <input type="password" id="regPassword" required><br>
        <button type="submit">Register</button>
    </form>

    <!-- Login Form -->
    <h2>Login</h2>
    <form id="loginForm">
        <label for="loginUsername">Username:</label>
        <input type="text" id="loginUsername" required><br>
        <label for="loginPassword">Password:</label>
        <input type="password" id="loginPassword" required><br>
        <button type="submit">Login</button>
    </form>

    <!-- Message Display -->
    <div id="message"></div>

    <script>
        const registrationForm = document.getElementById("registrationForm");
        const loginForm = document.getElementById("loginForm");
        const messageDiv = document.getElementById("message");

        // User service URL (replace with the actual URL)
        const userRegServiceURL = "http://localhost:8080/register";
        const userLoginServiceURL = "http://localhost:8080/login";
        const frontendOrigin = "http://localhost:5500/frontend/index.html"

        registrationForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const regUsername = registrationForm.elements.regUsername.value;
            const regPassword = registrationForm.elements.regPassword.value;

            // Send registration data to the user service API
            const registrationData = { username: regUsername, password: regPassword };
            try {
                const response = await fetch(userRegServiceURL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Origin": frontendOrigin,
                    },
                    body: JSON.stringify(registrationData),
                });

                if (response.status === 201) {
                    showMessage("User has been registered successfully.");
                } else {
                    const errorMessage = await response.text();
                    showMessage(`Registration failed: ${errorMessage}`);

                }
            } catch (error) {
                showMessage("Error during registration.");
                console.error(error);
            }

            registrationForm.reset();
        });

        loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const loginUsername = loginForm.elements.loginUsername.value;
            const loginPassword = loginForm.elements.loginPassword.value;

            // Send login data to the user service API
            const loginData = { username: loginUsername, password: loginPassword };
            try {
                const response = await fetch(userLoginServiceURL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Origin":frontendOrigin,
                    },
                    body: JSON.stringify(loginData),
                });

                if (response.status === 200) {
                    showMessage("Successfully logged in.");
                } else {
                    showMessage("Login failed.");
                }
            } catch (error) {
                showMessage("Error during login.");
                console.error(error);
            }

            loginForm.reset();
        });

        function showMessage(message) {
            messageDiv.textContent = message;
        }
    </script>
</body>
</html>
